---
title: "Next.js SSGã§Imageã‚¿ã‚°ã®ã‚¨ãƒ©ãƒ¼ã«å¯¾å‡¦ã™ã‚‹æ–¹æ³•"
emoji: "ğŸ¨"
type: "tech"
topics:
  - "nextjs"
  - "react"
  - "ssg"
published: true
published_at: "2023-04-19 03:43"
---

# Imageã‚¿ã‚°ã‚¨ãƒ©ãƒ¼

Next.jsã§é™çš„ã‚µã‚¤ãƒˆç”Ÿæˆ(SSG)ã‚’è¡Œã†éš›ã«ã€`Image`ã‚¿ã‚°ã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
ã‚¨ãƒ©ãƒ¼å†…å®¹ã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

```
Error: Image Optimization using Next.js' default loader is not compatible with `next export`.
  Possible solutions:
    - Use `next start` to run a server, which includes the Image Optimization API.
    - Use any provider which supports Image Optimization (like Vercel).
    - Configure a third-party loader in `next.config.js`.
    - Use the `loader` prop for `next/image`.
```

next exportã¯Next.jsãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ­ãƒ¼ãƒ€ãƒ¼ã®Image Optimizationã¨äº’æ›æ€§ãŒãªãã€è¦ã¯`<Image>`ã‚¿ã‚°ã¯SSGã«ã¯ä½¿ãˆãªã„ã‚ˆã†ã§ã™ã€‚

ä»•æ–¹ãŒãªã„ã®ã§ç”»åƒã‚’`<img>`ã‚¿ã‚°ã«ç½®ãæ›ãˆã¦ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¨ã«ã—ã¾ã—ãŸã€‚

# ESLintã‚¨ãƒ©ãƒ¼

ä»Šåº¦ã¯ESLintã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚

```
warn  - Statically exporting a Next.js application via `next export` disables API routes and middleware.
This command is meant for static-only hosts, and is not necessary to make your application static.
Pages in your application without server-side data dependencies will be automatically statically exported by `next build`, including pages powered by `getStaticProps`.
Learn more: https://nextjs.org/docs/messages/api-routes-static-export
```

next exportã¯é™çš„ãƒ›ã‚¹ãƒˆå°‚ç”¨ã§APIãƒ«ãƒ¼ãƒˆã¨ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ãã‚Œã®å½±éŸ¿ã‚‰ã—ã„ã€‚
ã“ã¡ã‚‰ã¯ESLintã®å¯¾è±¡ã‹ã‚‰é™¤å¤–ã™ã‚‹ã“ã¨ã§å›é¿ã—ã¾ã—ãŸã€‚

`.eslintrc`

```diff
{
  "extends": "next/core-web-vitals",
+  "rules": {
+    "@next/next/no-img-element": "off"
+  }
}
```

# ç”»åƒãŒè¡¨ç¤ºã•ã‚Œãªã„

ã“ã‚Œã§ãƒ“ãƒ«ãƒ‰ã¯é€šã£ãŸã®ã§ã™ãŒã€ä»Šåº¦ã¯ç”»åƒãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚Œãªã„äº‹è±¡ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
`Image`ã‹ã‚‰`img`ã‚¿ã‚°ã«ç½®ãæ›ãˆãŸã“ã¨ã§ã€æ­£ã—ã„PathãŒç”Ÿæˆã•ã‚Œãªããªã£ãŸã¿ãŸã„ã§ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/eca577c91d11-20230419.png)

Pathã‚’è€ƒæ…®ã—ãŸ`StaticImage`ã¨ã„ã†componentã‚’ä½œæˆã—ã¦ã€`img`ã‚¿ã‚°ã¨ç½®æ›ã—ã¦å¯¾å¿œã—ã¾ã—ãŸ

`component/StaticImage.tsx`

```javascript
import React from 'react'
const isProd = process.env.NODE_ENV === 'production'
const prefixPath = !isProd ? '/portfolio' : ''

function withPrefix(path: string) {
  return `${prefixPath}${path}`
}

interface StaticImageProps {
  src: string
  alt: string
  className?: string
  width?: number
  height?: number
}

export default function StaticImage({ src, alt, ...props }: StaticImageProps) {
  return <img src={withPrefix(src)} alt={alt} {...props} />
}
```

`pages/index.tsx`

```javascript
import Image from "next/image";
import StaticImage from "../component/StaticImage";
import { Inter } from "next/font/google";

const inter = Inter({ subsets: ["latin"] });

export default function Home() {
  return (
    // ...
    <StaticImage
      src="/vercel.svg"
      alt="Vercel Logo"
      className="dark:invert"
      width={100}
      height={24}
    />
    // ...
  );
}
```

ã“ã‚Œã«ã‚ˆã‚Šã€äº‹è±¡ã¯è§£æ¶ˆã—ã¾ã—ãŸï¼

![](https://storage.googleapis.com/zenn-user-upload/06ba1ffbb00a-20230419.png)

ãŸã ç”»åƒå‘¨ã‚Šã¯ã¾ã è‰²ã€…å•é¡ŒãŒå‡ºã¦ããã†ã§ã™ã­ã€‚ã€‚ã€‚
